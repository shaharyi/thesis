# -*- coding: utf-8 -*-
"""
===================================
Demo of DBSCAN clustering algorithm
===================================

Finds core samples of high density and expands clusters from them.

"""
print __doc__

#data in white:
data= [[(22, 10, 11), (21, 11, 10), (20, 12, 10), (19, 12, 10), (18, 12, 11), (17, 11, 12), (16, 12, 11), (15, 12, 10), (14, 13, 11), (13, 13, 11), (13, 13, 12), (13, 14, 11), (12, 15, 12), (12, 16, 11), (12, 17, 11), (13, 15, 10), (13, 15, 11), (13, 16, 10), (13, 17, 10), (13, 18, 10), (14, 12, 13), (14, 13, 12), (14, 14, 10), (14, 14, 11), (14, 15, 9), (14, 15, 10), (14, 16, 9), (14, 16, 10), (14, 17, 9), (14, 18, 9), (14, 19, 9), (14, 20, 9), (15, 12, 11), (15, 12, 12), (15, 13, 11), (15, 14, 10), (15, 15, 9), (15, 15, 10), (15, 16, 9), (15, 17, 9), (15, 18, 9), (16, 13, 10), (16, 14, 10), (16, 15, 9), (16, 16, 9), (16, 17, 8), (16, 18, 8), (16, 19, 8), (17, 12, 11), (17, 13, 10), (17, 14, 9), (17, 14, 10), (17, 15, 9), (17, 16, 8), (17, 17, 8), (17, 19, 8), (18, 13, 10), (18, 14, 9), (18, 15, 9), (18, 16, 8), (18, 19, 8), (19, 13, 10), (19, 14, 9), (19, 15, 9), (19, 16, 8), (19, 16, 9), (19, 19, 8), (20, 13, 10), (20, 14, 9), (20, 15, 9), (20, 16, 8), (21, 12, 10), (17, 16, 9), (17, 18, 8), (12, 14, 12), (12, 15, 11), (13, 14, 10), (15, 13, 10), (16, 17, 9), (18, 17, 8), (19, 17, 8), (14, 12, 11), (13, 16, 9), (13, 20, 9), (14, 21, 9), (16, 20, 8), (16, 14, 9), (18, 16, 9), (18, 18, 8), (19, 18, 8), (20, 17, 8), (18, 12, 10), (20, 16, 9), (13, 19, 9), (15, 20, 8), (12, 15, 10), (12, 19, 10), (17, 20, 8), (22, 12, 10), (14, 13, 10), (12, 17, 10), (12, 20, 10), (13, 12, 11), (15, 14, 9), (15, 11, 11), (19, 11, 11), (16, 11, 11), (20, 11, 11), (21, 12, 9), (13, 12, 12), (13, 21, 9), (16, 21, 8), (12, 14, 11), (16, 13, 9), (17, 21, 8), (20, 13, 9), (21, 13, 10), (21, 14, 9), (21, 17, 9), (22, 17, 9), (23, 18, 9), (23, 17, 9), (24, 18, 9), (25, 19, 9), (26, 19, 9), (27, 19, 9), (28, 18, 10), (28, 17, 10), (29, 17, 11), (27, 17, 10), (29, 16, 11), (29, 15, 12), (29, 14, 12), (29, 13, 11), (28, 12, 11), (28, 11, 12), (29, 11, 13), (30, 12, 13), (30, 13, 12), (28, 10, 13), (28, 15, 11), (30, 16, 12), (30, 15, 13), (27, 14, 11), (29, 15, 11), (29, 17, 10), (30, 15, 12), (28, 14, 11), (28, 16, 10), (28, 18, 9), (29, 14, 11), (30, 14, 12), (30, 16, 11), (31, 15, 13), (32, 16, 12), (32, 14, 14), (33, 15, 15), (33, 15, 16), (33, 15, 17), (33, 15, 18), (33, 15, 19), (33, 15, 20), (32, 14, 21), (32, 15, 22), (32, 16, 23), (32, 17, 23), (33, 16, 14), (33, 16, 15), (33, 16, 21), (33, 17, 14), (32, 13, 20), (32, 13, 19), (32, 15, 23), (31, 14, 24), (31, 13, 23), (30, 14, 25), (30, 15, 26), (31, 16, 25), (31, 15, 14), (30, 12, 24), (29, 16, 27), (28, 15, 28), (27, 16, 29), (26, 15, 29), (27, 17, 29), (26, 14, 29), (27, 13, 28), (28, 13, 27), (25, 16, 30), (25, 17, 30), (27, 18, 29), (25, 18, 30), (27, 19, 29), (26, 20, 29), (28, 20, 28), (29, 21, 27), (28, 22, 27), (29, 23, 26), (30, 20, 26), (28, 23, 27), (27, 22, 28), (27, 23, 28), (26, 21, 29), (25, 22, 29), (28, 21, 28), (28, 16, 28), (28, 17, 28), (32, 14, 22), (27, 16, 10), (27, 18, 9), (26, 16, 10), (27, 15, 10), (28, 15, 10), (28, 17, 9), (29, 16, 10), (30, 15, 11), (31, 13, 13), (33, 17, 13), (29, 15, 27), (32, 15, 13), (30, 16, 26), (25, 18, 9), (26, 15, 10), (26, 18, 9), (27, 17, 9), (29, 15, 10), (32, 13, 21), (29, 13, 26), (31, 16, 11), (25, 15, 10), (26, 13, 10), (26, 14, 10), (26, 17, 9), (27, 13, 10), (27, 14, 10), (27, 16, 9), (28, 14, 10), (28, 16, 9), (29, 18, 9), (30, 16, 10), (25, 13, 10), (25, 14, 10), (29, 17, 9), (22, 16, 9), (25, 17, 9), (26, 16, 9), (27, 15, 9), (27, 18, 8), (15, 21, 8), (16, 15, 8), (20, 15, 8), (26, 15, 9), (26, 18, 8), (14, 20, 8), (31, 12, 22), (21, 13, 9), (21, 16, 9), (25, 16, 9), (26, 14, 9), (12, 21, 10), (14, 22, 9), (30, 13, 25), (21, 18, 8), (25, 18, 8), (26, 17, 8), (14, 21, 8), (12, 13, 11), (15, 16, 8), (15, 19, 8), (18, 11, 11), (20, 11, 10), (20, 12, 9), (22, 12, 9), (32, 17, 12), (21, 15, 8), (24, 17, 9), (25, 15, 9), (12, 13, 12), (17, 11, 10), (22, 15, 9), (24, 14, 10), (24, 18, 8), (25, 17, 8), (12, 20, 9), (21, 16, 8), (22, 14, 9), (24, 13, 10), (24, 16, 9), (18, 21, 8), (12, 21, 9), (17, 21, 7), (11, 15, 11), (11, 19, 11), (12, 18, 10), (13, 22, 9), (15, 22, 8), (16, 16, 8), (16, 22, 8), (25, 14, 9), (33, 17, 21), (33, 18, 21), (33, 19, 21), (33, 20, 21), (33, 21, 21), (33, 22, 20), (17, 20, 7), (18, 21, 7), (11, 21, 10), (13, 18, 9), (17, 18, 7), (11, 16, 10), (11, 20, 10), (21, 15, 9), (22, 13, 10), (32, 16, 13), (17, 13, 9), (11, 18, 11), (19, 11, 10), (10, 20, 10), (10, 21, 10), (11, 19, 10), (11, 20, 11), (11, 21, 9), (12, 22, 9), (13, 21, 8), (14, 22, 8), (18, 18, 7), (24, 15, 30), (24, 14, 30), (10, 17, 11), (11, 17, 11), (15, 11, 12), (17, 11, 11), (17, 12, 10), (21, 11, 11), (22, 11, 10), (23, 12, 10), (17, 22, 7), (17, 22, 8), (18, 22, 7), (19, 21, 7), (20, 22, 8), (20, 21, 7), (20, 22, 7), (22, 13, 9), (12, 12, 12), (14, 19, 8), (16, 21, 7), (10, 18, 11), (10, 19, 10), (17, 15, 8), (10, 19, 11), (13, 22, 8), (15, 21, 7), (15, 22, 7), (15, 23, 7), (16, 22, 7), (23, 11, 10), (10, 16, 11), (10, 20, 11), (19, 13, 9), (22, 15, 8), (11, 14, 12), (19, 10, 11), (19, 12, 9), (20, 10, 11), (27, 20, 9), (12, 22, 10), (16, 23, 7), (18, 10, 11), (18, 11, 10), (19, 15, 8), (25, 16, 8), (21, 21, 7), (22, 21, 8), (17, 10, 11), (21, 10, 11), (11, 13, 12), (11, 16, 11), (11, 18, 10), (21, 17, 8), (25, 13, 9), (16, 24, 7), (17, 23, 7), (19, 22, 7), (20, 20, 8), (21, 20, 7), (21, 23, 7), (22, 20, 7), (22, 21, 7), (24, 20, 8), (24, 21, 8), (25, 21, 8), (26, 22, 7), (26, 23, 7), (26, 24, 7), (18, 22, 8), (11, 16, 12), (14, 11, 12), (18, 23, 7), (19, 20, 7), (11, 17, 10), (12, 19, 9), (15, 18, 8), (18, 9, 12), (19, 9, 12), (20, 9, 12), (22, 11, 11), (11, 21, 11), (17, 24, 7), (18, 20, 7), (19, 18, 7), (21, 24, 7), (23, 18, 8), (24, 15, 9), (25, 20, 8), (26, 21, 8), (12, 13, 13), (16, 11, 12), (24, 11, 10), (25, 10, 11), (28, 11, 13), (28, 11, 14), (28, 10, 15), (28, 10, 16), (28, 11, 15), (28, 12, 13), (29, 10, 15), (29, 10, 16), (16, 20, 7), (21, 21, 8), (23, 20, 8), (26, 20, 8), (10, 21, 11), (13, 11, 12), (15, 10, 12), (19, 10, 12), (19, 23, 7), (27, 10, 15), (28, 10, 14), (29, 11, 14), (29, 11, 15), (29, 12, 13), (30, 11, 15), (30, 13, 13), (9, 19, 12), (10, 15, 12), (11, 20, 9), (11, 22, 10), (13, 12, 13), (22, 16, 8), (24, 22, 29), (27, 10, 14), (27, 11, 13), (29, 12, 14), (29, 13, 13), (30, 11, 16), (30, 12, 14), (14, 23, 8), (15, 20, 7), (30, 14, 24), (31, 14, 22), (21, 19, 8), (25, 19, 8), (26, 19, 8), (27, 19, 8), (27, 20, 8), (18, 19, 7), (20, 23, 7), (15, 23, 8), (16, 10, 12), (16, 12, 10), (16, 19, 7), (17, 9, 12), (20, 10, 12), (21, 9, 12), (23, 10, 11), (24, 12, 10), (28, 9, 16), (30, 13, 14), (31, 12, 15), (31, 13, 14), (24, 17, 8), (29, 10, 17), (30, 10, 17), (23, 21, 7), (28, 19, 8), (30, 14, 23), (31, 14, 23), (13, 20, 8), (13, 23, 8), (16, 18, 7), (25, 23, 7), (25, 24, 7), (28, 9, 17), (31, 14, 13), (18, 24, 7), (19, 22, 8), (19, 24, 7), (22, 24, 7), (23, 24, 8), (31, 15, 24), (20, 19, 8), (21, 22, 7), (21, 22, 8), (22, 22, 7), (24, 18, 30), (23, 18, 30), (24, 19, 8), (24, 23, 8), (30, 15, 24), (30, 15, 25), (30, 16, 25), (17, 10, 12), (18, 10, 12), (21, 10, 12), (28, 12, 12), (29, 11, 16), (30, 12, 15), (33, 23, 19), (33, 24, 18), (33, 25, 17), (33, 25, 16), (33, 25, 15), (32, 26, 18), (31, 27, 19), (32, 26, 14), (31, 27, 13), (33, 24, 17), (33, 24, 16), (33, 24, 14), (33, 24, 15), (31, 26, 12), (31, 25, 11), (30, 25, 10), (33, 23, 14), (34, 22, 15), (34, 21, 15), (34, 22, 16), (34, 22, 17), (34, 21, 18), (34, 21, 17), (34, 20, 18), (34, 19, 19), (34, 21, 16), (34, 18, 18), (34, 18, 17), (34, 18, 16), (34, 19, 15), (34, 19, 16), (34, 19, 17), (34, 19, 18), (34, 20, 15), (34, 20, 16), (34, 20, 17), (33, 23, 18), (33, 23, 17), (33, 23, 16), (33, 23, 15), (11, 15, 12), (17, 23, 8), (21, 23, 8), (11, 23, 10), (27, 8, 17), (28, 10, 17), (31, 14, 21), (18, 20, 8), (20, 18, 7), (22, 20, 8), (24, 21, 29), (25, 22, 8), (26, 10, 14), (27, 9, 15), (27, 9, 16), (27, 10, 13), (28, 9, 15), (28, 13, 12), (29, 13, 12), (30, 14, 13), (31, 15, 12), (24, 17, 30), (30, 26, 20), (29, 27, 19), (28, 28, 19), (29, 29, 20), (28, 30, 20), (27, 31, 19), (26, 32, 18), (25, 32, 19), (24, 33, 18), (23, 33, 19), (23, 33, 20), (24, 33, 19), (25, 32, 20), (26, 32, 19), (27, 31, 18), (22, 33, 20), (23, 33, 18), (21, 33, 20), (20, 33, 21), (24, 33, 17), (24, 33, 16), (26, 32, 17), (26, 32, 16), (26, 31, 21), (25, 32, 15), (28, 30, 17), (29, 30, 17), (30, 29, 16), (30, 29, 15), (30, 29, 17), (31, 28, 15), (31, 28, 16), (31, 28, 17), (29, 30, 16), (28, 30, 16), (29, 28, 17), (29, 28, 16), (27, 31, 16), (27, 31, 17), (28, 29, 17), (29, 29, 15), (29, 28, 19), (29, 29, 16), (29, 29, 17), (30, 25, 20), (30, 27, 16), (30, 27, 20), (32, 24, 17), (11, 13, 13), (26, 8, 17), (27, 8, 18), (27, 9, 17), (13, 24, 8), (18, 23, 8), (20, 24, 7), (24, 24, 7), (27, 30, 15), (27, 31, 14), (27, 30, 13), (27, 30, 16), (28, 30, 15), (30, 13, 23), (30, 13, 24), (12, 12, 13), (22, 18, 30), (24, 19, 30), (26, 9, 15), (29, 12, 12), (24, 32, 21), (23, 32, 22), (26, 8, 16), (26, 8, 18), (27, 30, 21), (31, 13, 21), (26, 30, 13), (27, 30, 14), (27, 30, 17), (27, 31, 15), (28, 29, 16), (30, 12, 23), (23, 9, 12), (23, 8, 13), (26, 9, 14), (26, 9, 16), (26, 10, 13), (27, 10, 16), (29, 12, 15), (29, 28, 18), (29, 29, 19), (30, 12, 16), (30, 13, 15), (30, 27, 15), (30, 27, 19), (30, 28, 16), (30, 28, 17), (31, 12, 16), (31, 13, 15), (31, 14, 14), (32, 25, 17), (32, 25, 18), (21, 19, 7), (21, 20, 8), (23, 14, 30), (24, 18, 29), (26, 30, 12), (26, 30, 14), (28, 30, 14), (29, 10, 18), (29, 11, 17), (30, 10, 18), (30, 11, 17), (32, 16, 22), (14, 23, 9), (16, 23, 8), (17, 19, 7), (18, 25, 7), (28, 29, 21), (9, 20, 12), (10, 16, 12), (10, 20, 12), (11, 12, 13), (23, 14, 9), (14, 12, 12), (25, 7, 18), (25, 19, 29), (25, 30, 13), (26, 8, 15), (27, 29, 12), (28, 9, 18), (28, 29, 13), (28, 29, 14), (28, 29, 15), (29, 17, 26), (31, 14, 20), (33, 23, 13)], [(25, 24, 28)], [(32, 23, 11)], [(30, 23, 9), (29, 22, 8)], [(19, 27, 27)], [(31, 18, 10)], [(14, 28, 12), (14, 29, 12), (15, 30, 13), (15, 29, 12), (15, 29, 13), (14, 30, 12), (15, 30, 12)], [(13, 31, 15), (13, 31, 16), (13, 31, 17), (12, 30, 18), (11, 30, 19), (12, 30, 20), (12, 30, 19), (13, 31, 19), (12, 30, 21), (13, 30, 22), (14, 30, 23), (15, 30, 24), (14, 29, 24), (15, 29, 25), (13, 31, 20), (14, 30, 22), (14, 31, 21), (15, 30, 23), (11, 30, 18), (11, 29, 20), (10, 28, 21), (12, 29, 22), (13, 29, 23), (11, 29, 21), (10, 29, 19), (14, 31, 17), (12, 29, 21), (13, 30, 21), (14, 31, 20), (9, 28, 19), (13, 30, 17), (13, 31, 18), (14, 31, 16), (14, 32, 17), (14, 29, 23), (15, 29, 24), (9, 27, 20), (8, 26, 19), (8, 26, 20), (9, 27, 21), (10, 28, 20), (11, 29, 19), (11, 30, 17), (11, 29, 16), (14, 31, 15)], [(14, 9, 16), (13, 10, 16), (12, 11, 16), (14, 10, 16), (12, 10, 16)], [(10, 11, 19), (10, 11, 20)]]
from pdb import *
import numpy as np
from scipy.spatial import distance
from sklearn.cluster.dbscan_sparse import DBSCAN
from sklearn import metrics
from sklearn.datasets.samples_generator import make_blobs


##############################################################################
# Generate sample data
#centers = [[1, 1], [-1, -1], [1, -1]]
centers = [[ 1, 1, 1], [-1,-1,-1], [ 1, 0,-1]]
X, labels_true = make_blobs(n_samples=750, centers=centers, cluster_std=0.4)

#D = distance.squareform(distance.pdist(pts))

X = np.array(sum(data,[]))

##############################################################################
# Compute similarities
#D = distance.squareform(distance.pdist(X))
#S = 1 - (D / np.max(D))
#set_trace()
##############################################################################
# Compute DBSCAN
##db = DBSCAN().fit(S, eps=0.95, min_samples=10)
##db = DBSCAN().fit(S, eps=.85, min_samples=2)
##db = DBSCAN().fit(D, eps=1.5, min_samples=10,metric='precomputed')
#db = DBSCAN(eps=1.5, min_samples=10,metric='precomputed').fit(D)

db = DBSCAN(eps=1.5, min_samples=10).fit(X)
core_samples = db.core_sample_indices_
labels = db.labels_

# Number of clusters in labels, ignoring noise if present.
n_clusters_ = len(set(labels)) - (1 if -1 in labels else 0)
"""
print 'Estimated number of clusters: %d' % n_clusters_
print "Homogeneity: %0.3f" % metrics.homogeneity_score(labels_true, labels)
print "Completeness: %0.3f" % metrics.completeness_score(labels_true, labels)
print "V-measure: %0.3f" % metrics.v_measure_score(labels_true, labels)
print "Adjusted Rand Index: %0.3f" % \
    metrics.adjusted_rand_score(labels_true, labels)
print "Adjusted Mutual Information: %0.3f" % \
    metrics.adjusted_mutual_info_score(labels_true, labels)
print ("Silhouette Coefficient: %0.3f" %
       metrics.silhouette_score(D, labels, metric='precomputed'))
"""

##############################################################################
# Plot result
import pylab as pl
import matplotlib.pyplot as plt

from mpl_toolkits.mplot3d import Axes3D
from itertools import cycle

#pl.close('all')
fig=plt.figure(1)
ax = fig.gca(projection='3d')
#pl.clf()

# Black removed and is used for noise instead.
colors = cycle('bgrcmybgrcmybgrcmybgrcmy')

for k, col in zip([0,1,2], colors):
#for k, col in zip(set(labels), colors):
    if k == -1:
        # Black used for noise.
        col = 'k'
        markersize = 6
    class_members = [index[0] for index in np.argwhere(labels == k)]
    cluster_core_samples = [index for index in core_samples
                            if labels[index] == k]
    for index in class_members:
        x = X[index]
        if index in core_samples and k != -1:
            markersize = 14
        else:
            markersize = 6
        ax.plot([x[0]], [x[1]],[x[2]], 'o', markerfacecolor=col,
                markeredgecolor='k', markersize=markersize)

pl.title('Estimated number of clusters: %d' % n_clusters_)
pl.show()
